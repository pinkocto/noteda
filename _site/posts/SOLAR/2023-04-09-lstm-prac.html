<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="JiyunLim">
<meta name="dcterms.date" content="2023-04-10">

<title>noteda - LSTM for Time Series Prediction (연습)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">noteda</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../about.html" aria-current="page">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pinkocto/noteda"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">LSTM for Time Series Prediction (연습)</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title d-none d-lg-block">LSTM for Time Series Prediction (연습)</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">SOLAR</div>
                <div class="quarto-category">Model</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>JiyunLim </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 10, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about.html" class="sidebar-item-text sidebar-link">About</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Posts</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/2023-03-23-read-list.html" class="sidebar-item-text sidebar-link">Lists to read</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/welcome/index.html" class="sidebar-item-text sidebar-link">Welcome To My Blog</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">DataHandling</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/DataHandling/2023-04-02-assign.html" class="sidebar-item-text sidebar-link">[Python] 새로운 열 할당(.assign) 및 특정 열 선택</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/DataHandling/2023-04-02-hanling-index.html" class="sidebar-item-text sidebar-link">[Python] 중첩인덱스 깨는 법</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/DataHandling/2023-04-06-pivot-wider-error.html" class="sidebar-item-text sidebar-link">[R] pivot_wider Error</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/DataHandling/2023-04-06-assign-r.html" class="sidebar-item-text sidebar-link">[R] 문자열을 변수명으로 &amp; assign</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">Etc</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/etc/2023-03-21-dv.html" class="sidebar-item-text sidebar-link">data visualization</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/etc/2023-03-21-downcasting.html" class="sidebar-item-text sidebar-link">downcasting</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/etc/2023-04-11-git-error.html" class="sidebar-item-text sidebar-link">Github remote: error: this exceeds GitHub’s file size limit of 100.00 MB</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/etc/2023-02-24-tips.html" class="sidebar-item-text sidebar-link">Julia 설치 및 실행</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/etc/2023-03-21-lib.html" class="sidebar-item-text sidebar-link">Libraries for DA</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/etc/2023-04-05-ppt.html" class="sidebar-item-text sidebar-link">ppt 폰트</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/etc/2023-04-23-r-python-same-jupyter.html" class="sidebar-item-text sidebar-link">R/Python jupyter</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/etc/2023-03-21-resumetable.html" class="sidebar-item-text sidebar-link">resumetable</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/etc/2023-03-21-scorecard.html" class="sidebar-item-text sidebar-link">Scorecard</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/etc/2023-04-02-abstract.html" class="sidebar-item-text sidebar-link">초록 작성법</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/etc/2023-04-01-학회.html" class="sidebar-item-text sidebar-link">학회</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">HousePrice</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/HousePrice/2023-04-05-5wk.html" class="sidebar-item-text sidebar-link">5wk: 측도론 (1)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/HousePrice/2023-04-04-lr-hw1.html" class="sidebar-item-text sidebar-link">House Price</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/HousePrice/2023-04-05-hw1-feedback.html" class="sidebar-item-text sidebar-link">House Price feedback</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">Seminar</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/Seminar/2023-03-21-gpt3-nsmc.html" class="sidebar-item-text sidebar-link">Few-shot learning using GPT3</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">SOLAR</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-03-30-correlation.html" class="sidebar-item-text sidebar-link">[R]Correlation coefficient by region</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-03-30-restructure-data.html" class="sidebar-item-text sidebar-link">[R]데이터 재구조화</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-23-결과비교.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> Comparison of 30 simulation results</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-06-corr.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> Correlation coefficient by region</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-12-데이터수정.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> Crate Dataset (22/06~22/09/15)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-14-데이터수정2.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> Crate Dataset (data2: 22/06~22/09/15) 재수정</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-20-데이터수정3.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> Create Dataset (data3: 0815/0910) 재수정</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-06-stgcn-data-ver1.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> Dataset for STGCN Ver1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-07-stcgn-data-ver2.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> Dataset for STGCN Ver2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-04-EPT.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> EPT</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-06-ept-by-region.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> EPT by region</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-10-lstm.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> LSTM</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-21-정규화-스케일링-stgcn-ver1--guebin.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver1 (+N +S) (MSE: 0.1864) – guebin</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-22-정규화-스케일링-stgcn-ver1.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver1 (data2, +N +S) 30회</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-17-정규화-stgcn-ver1-.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver1 (data2, +N) (MSE: 0.1705)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-20-정규화-데이터3-stgcn-ver1.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver1 (Full: 08/15~09/10 data3) (MSE: 0.1523)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-12-stgcn-ver1.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver1 (MSE: 0.1899)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-12-stgcn-ver1-train90.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver1 90% (MSE: 0.1206)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-09-soloar-stgcn-ver1-lag1.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver1 lag1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-07-soloar-stgcn-ver1-lag4.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver1 lag4</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-15-stgcn-ver1-수정본.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver1 수정본 (MSE: 0.1674)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-21-정규화-스케일링-stgcn-ver2--guebin.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver2 (+N +S) (MSE: 0.1801) – guebin</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-22-정규화-스케일링-stgcn-ver2.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver2 (data2, +N +S) 30회</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-17-정규화-stgcn-ver2.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver2 (data2, +N) (MSE: 0.1834)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-20-정규화-데이터3-stgcn-ver2.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver2 (Full: 08/15~09/10 data3) (MSE: 0.1927)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-12-stgcn-ver2-train90.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver2 (MSE: 0.2019)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-12-stgcn-ver2.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver2 90% (MSE: 0.1635)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-09-solar-stgcn-ver2-lag1.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver2 lag1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-08-solar-stgcn-ver2-lag4.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver2 lag4</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-15-stgcn-ver2-수정본.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> STGCN Ver2 수정본 (MSE: 0.2000)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-03-01-todolist.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> To do list</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-06-solar-class.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> WindmillOutputLargeDatasetLoader</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-07-yu.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> yU</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-19-데이터탐색용.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> 데이터 탐색용</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-22-시각화코드수정.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> 연습용 (시각화 코드 수정)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-06-stgcn.html" class="sidebar-item-text sidebar-link">ChikenpoxDataset</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-03-29-data0.html" class="sidebar-item-text sidebar-link">Data preprocessing</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-09-lstm-prac.html" class="sidebar-item-text sidebar-link active">LSTM for Time Series Prediction (연습)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-06-windmill.html" class="sidebar-item-text sidebar-link">WindmillOutputLargeDataset 분석 (실패)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-03-일사량.html" class="sidebar-item-text sidebar-link">일사량자료정리</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/SOLAR/2023-04-09-ft.html" class="sidebar-item-text sidebar-link">푸리에 변환</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">Study</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/Study/2023-04-11-arima-hour-data-fill.html" class="sidebar-item-text sidebar-link"><strong>[SOLAR]</strong> SARIMA (MSE: 0.478)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/Study/2023-04-10-arima-ex-day.html" class="sidebar-item-text sidebar-link">ARIMA (Day)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/Study/2023-04-10-arima-ex.html" class="sidebar-item-text sidebar-link">ARIMA (시간별 예측안됨, 에러)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/Study/2023-04-13-windmill-스몰버전.html" class="sidebar-item-text sidebar-link">WindmillOutput (Small)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/Study/python_7장.html" class="sidebar-item-text sidebar-link">스타벅스 주가예측</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/Study/2023-04-10-ex.html" class="sidebar-item-text sidebar-link">연습장</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/Study/2023-04-03-일사량.html" class="sidebar-item-text sidebar-link">일사량자료정리(수정 for ARIMA)</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#lstm-for-time-series-prediction" id="toc-lstm-for-time-series-prediction" class="nav-link active" data-scroll-target="#lstm-for-time-series-prediction">LSTM for Time Series Prediction</a>
  <ul class="collapse">
  <li><a href="#import" id="toc-import" class="nav-link" data-scroll-target="#import">import</a></li>
  <li><a href="#train-test-split" id="toc-train-test-split" class="nav-link" data-scroll-target="#train-test-split">train test split</a></li>
  <li><a href="#lookback1" id="toc-lookback1" class="nav-link" data-scroll-target="#lookback1">lookback=1</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  <li><a href="#training-and-verifying-your-lstm-network" id="toc-training-and-verifying-your-lstm-network" class="nav-link" data-scroll-target="#training-and-verifying-your-lstm-network">Training and Verifying Your LSTM Network</a></li>
  <li><a href="#lookback4" id="toc-lookback4" class="nav-link" data-scroll-target="#lookback4">lookback=4</a></li>
  <li><a href="#lookback" id="toc-lookback" class="nav-link" data-scroll-target="#lookback">lookback?</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="lstm-for-time-series-prediction" class="level1">
<h1>LSTM for Time Series Prediction</h1>
<blockquote class="blockquote">
<p>연습용, LSTM을 사용하여 시계열 예측 신경망 구축</p>
</blockquote>
<ul>
<li>lookback이 의미하는바를 정확히 모르겠음.</li>
</ul>
<p>Let’s see how LSTM can be used to build a time series prediction neural network with an example.</p>
<p>The problem you will look at in this post is the international airline passengers prediction problem. This is a problem where, given a year and a month, the task is to predict the number of international airline passengers in units of 1,000. The data ranges from January 1949 to December 1960, or 12 years, with 144 observations.</p>
<p>It is a regression problem. That is, given the number of passengers (in unit of 1,000) the recent months, what is the number of passengers the next month. The dataset has only one feature: The number of passengers.</p>
<ul>
<li>국제 항공사 승객 수(1000명 단위)를 예측하는 문제</li>
<li>데이터 범위는 1949년 1월부터 1960년 12월까지이며 1달단위로 관측된 데이터이며, 관측치는 <span class="math inline">\(144(12\times 12)\)</span>개</li>
</ul>
<section id="import" class="level2">
<h2 class="anchored" data-anchor-id="import">import</h2>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'https://raw.githubusercontent.com/jbrownlee/Datasets/master/airline-passengers.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Month</th>
      <th>Passengers</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1949-01</td>
      <td>112</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1949-02</td>
      <td>118</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1949-03</td>
      <td>132</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1949-04</td>
      <td>129</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1949-05</td>
      <td>121</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 144 entries, 0 to 143
Data columns (total 2 columns):
 #   Column      Non-Null Count  Dtype 
---  ------      --------------  ----- 
 0   Month       144 non-null    object
 1   Passengers  144 non-null    int64 
dtypes: int64(1), object(1)
memory usage: 2.4+ KB</code></pre>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>timeseries <span class="op">=</span> df[[<span class="st">'Passengers'</span>]].values.astype(<span class="st">'float32'</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>plt.plot(timeseries)</span>
<span id="cb5-4"><a href="#cb5-4"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-04-09-lstm-prac_files/figure-html/cell-5-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>This time series has 144 time steps. You can see from the plot that there is an upward trend. There are also some periodicity in the dataset that corresponds to the summer holiday period in the northern hemisphere. Usually a time series should be “detrended” to remove the linear trend component and normalized before processing. For simplicity, these are skipped in this projectc</p>
<ul>
<li>증가하는 추세를 보이지만 여기서는 따로 처리하지 않았음.</li>
</ul>
</section>
<section id="train-test-split" class="level2">
<h2 class="anchored" data-anchor-id="train-test-split">train test split</h2>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># train-test split for time series</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>train_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(timeseries) <span class="op">*</span> <span class="fl">0.67</span>) <span class="co"># train ratio = 67%</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>test_size <span class="op">=</span> <span class="bu">len</span>(timeseries) <span class="op">-</span> train_size</span>
<span id="cb6-4"><a href="#cb6-4"></a>train_size, test_size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>(96, 48)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>train, test <span class="op">=</span> timeseries[:train_size], timeseries[train_size:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>train.shape, test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>((96, 1), (48, 1))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="im">import</span> torch</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="kw">def</span> create_dataset(dataset, lookback):</span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="co">"""Transform a time series into a prediction dataset</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">    </span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">    Args:</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">        dataset: A numpy array of time series, first dimension is the time steps</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">        lookback: Size of window for prediction</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">    """</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>    X, y <span class="op">=</span> [], []</span>
<span id="cb11-11"><a href="#cb11-11"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(dataset)<span class="op">-</span>lookback):</span>
<span id="cb11-12"><a href="#cb11-12"></a>        feature <span class="op">=</span> dataset[i:i<span class="op">+</span>lookback]</span>
<span id="cb11-13"><a href="#cb11-13"></a>        target <span class="op">=</span> dataset[i<span class="op">+</span><span class="dv">1</span>:i<span class="op">+</span>lookback<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb11-14"><a href="#cb11-14"></a>        X.append(feature)</span>
<span id="cb11-15"><a href="#cb11-15"></a>        y.append(target)</span>
<span id="cb11-16"><a href="#cb11-16"></a>    <span class="cf">return</span> torch.tensor(X), torch.tensor(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function is designed to apply windows on the time series. It is assumed to predict for one time step into the immediate future. It is designed to convert a time series into a tensor of dimensions (window sample, time steps, features). A time series of time steps can produce roughly windows (because a window can start from any time step as long as the window does not go beyond the boundary of the time series). Within one window, there are multiple consecutive time steps of values. In each time step, there can be multiple features. In this dataset, there is only one.</p>
</section>
<section id="lookback1" class="level2">
<h2 class="anchored" data-anchor-id="lookback1">lookback=1</h2>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>lookback <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>X_train, y_train <span class="op">=</span> create_dataset(train, lookback<span class="op">=</span>lookback)</span>
<span id="cb12-3"><a href="#cb12-3"></a>X_test, y_test <span class="op">=</span> create_dataset(test, lookback<span class="op">=</span>lookback)</span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="bu">print</span>(X_train.shape, y_train.shape)</span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="bu">print</span>(X_test.shape, y_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([95, 1, 1]) torch.Size([95, 1, 1])
torch.Size([47, 1, 1]) torch.Size([47, 1, 1])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>X_train[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>tensor([[[112.]],

        [[118.]],

        [[132.]],

        [[129.]],

        [[121.]]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>y_train[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">
<pre><code>tensor([[[118.]],

        [[132.]],

        [[129.]],

        [[121.]],

        [[135.]]])</code></pre>
</div>
</div>
<p>Now you can build the LSTM model to predict the time series. With lookback=1, it is quite surely that the accuracy would not be good for too little clues to predict. But this is a good example to demonstrate the structure of the LSTM model.</p>
</section>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<p>The model is created as a class, in which a LSTM layer and a fully-connected layer is used.</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb18-2"><a href="#cb18-2"></a> </span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="kw">class</span> AirModel(nn.Module):</span>
<span id="cb18-4"><a href="#cb18-4"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb18-5"><a href="#cb18-5"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb18-6"><a href="#cb18-6"></a>        <span class="va">self</span>.lstm <span class="op">=</span> nn.LSTM(input_size<span class="op">=</span><span class="dv">1</span>, hidden_size<span class="op">=</span><span class="dv">50</span>, num_layers<span class="op">=</span><span class="dv">1</span>, batch_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-7"><a href="#cb18-7"></a>        <span class="va">self</span>.linear <span class="op">=</span> nn.Linear(<span class="dv">50</span>, <span class="dv">1</span>)</span>
<span id="cb18-8"><a href="#cb18-8"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb18-9"><a href="#cb18-9"></a>        x, _ <span class="op">=</span> <span class="va">self</span>.lstm(x)</span>
<span id="cb18-10"><a href="#cb18-10"></a>        x <span class="op">=</span> <span class="va">self</span>.linear(x)</span>
<span id="cb18-11"><a href="#cb18-11"></a>        <span class="cf">return</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output of nn.LSTM() is a tuple. The first element is the generated hidden states, one for each time step of the input. The second element is the LSTM cell’s memory and hidden states, which is not used here.</p>
</section>
<section id="training-and-verifying-your-lstm-network" class="level2">
<h2 class="anchored" data-anchor-id="training-and-verifying-your-lstm-network">Training and Verifying Your LSTM Network</h2>
<p>Because it is a regression problem, MSE is chosen as the loss function, which is to be minimized by Adam optimizer. In the code below, the PyTorch tensors are combined into a dataset using <code>torch.utils.data.TensorDataset()</code> and batch for training is provided by a <code>DataLoader</code>. The model performance is evaluated once per 100 epochs, on both the trainning set and the test set:</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="im">import</span> torch.utils.data <span class="im">as</span> data</span>
<span id="cb19-4"><a href="#cb19-4"></a> </span>
<span id="cb19-5"><a href="#cb19-5"></a>model <span class="op">=</span> AirModel()</span>
<span id="cb19-6"><a href="#cb19-6"></a>optimizer <span class="op">=</span> optim.Adam(model.parameters())</span>
<span id="cb19-7"><a href="#cb19-7"></a>loss_fn <span class="op">=</span> nn.MSELoss()</span>
<span id="cb19-8"><a href="#cb19-8"></a>loader <span class="op">=</span> data.DataLoader(data.TensorDataset(X_train, y_train), shuffle<span class="op">=</span><span class="va">True</span>, batch_size<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb19-9"><a href="#cb19-9"></a> </span>
<span id="cb19-10"><a href="#cb19-10"></a>n_epochs <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(n_epochs):</span>
<span id="cb19-12"><a href="#cb19-12"></a>    model.train()</span>
<span id="cb19-13"><a href="#cb19-13"></a>    <span class="cf">for</span> X_batch, y_batch <span class="kw">in</span> loader:</span>
<span id="cb19-14"><a href="#cb19-14"></a>        y_pred <span class="op">=</span> model(X_batch)</span>
<span id="cb19-15"><a href="#cb19-15"></a>        loss <span class="op">=</span> loss_fn(y_pred, y_batch)</span>
<span id="cb19-16"><a href="#cb19-16"></a>        optimizer.zero_grad()</span>
<span id="cb19-17"><a href="#cb19-17"></a>        loss.backward()</span>
<span id="cb19-18"><a href="#cb19-18"></a>        optimizer.step()</span>
<span id="cb19-19"><a href="#cb19-19"></a>    <span class="co"># Validation</span></span>
<span id="cb19-20"><a href="#cb19-20"></a>    <span class="cf">if</span> epoch <span class="op">%</span> <span class="dv">100</span> <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb19-21"><a href="#cb19-21"></a>        <span class="cf">continue</span></span>
<span id="cb19-22"><a href="#cb19-22"></a>    model.<span class="bu">eval</span>()</span>
<span id="cb19-23"><a href="#cb19-23"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb19-24"><a href="#cb19-24"></a>        y_pred <span class="op">=</span> model(X_train)</span>
<span id="cb19-25"><a href="#cb19-25"></a>        train_rmse <span class="op">=</span> np.sqrt(loss_fn(y_pred, y_train))</span>
<span id="cb19-26"><a href="#cb19-26"></a>        y_pred <span class="op">=</span> model(X_test)</span>
<span id="cb19-27"><a href="#cb19-27"></a>        test_rmse <span class="op">=</span> np.sqrt(loss_fn(y_pred, y_test))</span>
<span id="cb19-28"><a href="#cb19-28"></a>    <span class="bu">print</span>(<span class="st">"Epoch </span><span class="sc">%d</span><span class="st">: train RMSE </span><span class="sc">%.4f</span><span class="st">, test RMSE </span><span class="sc">%.4f</span><span class="st">"</span> <span class="op">%</span> (epoch, train_rmse, test_rmse))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 0: train RMSE 225.9365, test RMSE 422.3676
Epoch 100: train RMSE 184.9790, test RMSE 379.4668
Epoch 200: train RMSE 152.4027, test RMSE 344.3236
Epoch 300: train RMSE 124.2188, test RMSE 312.2975
Epoch 400: train RMSE 101.0204, test RMSE 283.2189
Epoch 500: train RMSE 82.6843, test RMSE 257.0794
Epoch 600: train RMSE 66.4356, test RMSE 231.9688
Epoch 700: train RMSE 54.0870, test RMSE 208.9810
Epoch 800: train RMSE 44.0830, test RMSE 188.2280
Epoch 900: train RMSE 37.0532, test RMSE 169.9665
Epoch 1000: train RMSE 32.5043, test RMSE 154.2343
Epoch 1100: train RMSE 28.9322, test RMSE 141.3780
Epoch 1200: train RMSE 27.4202, test RMSE 131.0028
Epoch 1300: train RMSE 25.8251, test RMSE 122.6009
Epoch 1400: train RMSE 25.7696, test RMSE 116.9653
Epoch 1500: train RMSE 24.2167, test RMSE 111.3310
Epoch 1600: train RMSE 24.6531, test RMSE 106.7048
Epoch 1700: train RMSE 24.3270, test RMSE 103.3886
Epoch 1800: train RMSE 23.5308, test RMSE 101.1581
Epoch 1900: train RMSE 23.3630, test RMSE 99.4288</code></pre>
</div>
</div>
<p>As the dataset is small, the model should be trained for long enough to learn about the pattern. Over these 2000 epochs trained, you should see the RMSE on both training set and test set decreasing:</p>
<p>It is expected to see the RMSE of test set is an order of magnitude larger. The RMSE of 100 means the prediction and the actual target would be in average off by 100 in value (i.e., 100,000 passengers in this dataset).</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb21-2"><a href="#cb21-2"></a>plt.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> <span class="st">'NanumGothic'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb22-2"><a href="#cb22-2"></a>    <span class="co"># shift train predictions for plotting</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>    train_plot <span class="op">=</span> np.ones_like(timeseries) <span class="op">*</span> np.nan</span>
<span id="cb22-4"><a href="#cb22-4"></a>    y_pred <span class="op">=</span> model(X_train)</span>
<span id="cb22-5"><a href="#cb22-5"></a>    y_pred <span class="op">=</span> y_pred[:, <span class="op">-</span><span class="dv">1</span>, :]</span>
<span id="cb22-6"><a href="#cb22-6"></a>    train_plot[lookback:train_size] <span class="op">=</span> model(X_train)[:, <span class="op">-</span><span class="dv">1</span>, :]</span>
<span id="cb22-7"><a href="#cb22-7"></a>    <span class="co"># shift test predictions for plotting</span></span>
<span id="cb22-8"><a href="#cb22-8"></a>    test_plot <span class="op">=</span> np.ones_like(timeseries) <span class="op">*</span> np.nan</span>
<span id="cb22-9"><a href="#cb22-9"></a>    test_plot[train_size<span class="op">+</span>lookback:<span class="bu">len</span>(timeseries)] <span class="op">=</span> model(X_test)[:, <span class="op">-</span><span class="dv">1</span>, :]</span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="co"># plot</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>plt.plot(timeseries, c<span class="op">=</span><span class="st">'b'</span>, label <span class="op">=</span> <span class="st">'실제관측치'</span>)</span>
<span id="cb22-12"><a href="#cb22-12"></a>plt.plot(train_plot, c<span class="op">=</span><span class="st">'r'</span>, label <span class="op">=</span> <span class="st">'train'</span>)</span>
<span id="cb22-13"><a href="#cb22-13"></a>plt.plot(test_plot, c<span class="op">=</span><span class="st">'g'</span>, label <span class="op">=</span> <span class="st">'test'</span>)</span>
<span id="cb22-14"><a href="#cb22-14"></a>plt.legend()</span>
<span id="cb22-15"><a href="#cb22-15"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-04-09-lstm-prac_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The training set is plotted in red while the test set is plotted in green. The blue curve is what the actual data looks like. You can see that the model can fit well to the training set but not very well on the test set.</p>
<ul>
<li>training set 에 대해서는 잘 맞추는 것 같은데 test set에 대해서는 잘 맞추지 못한다.</li>
</ul>
<p>Tying together, below is the complete code, except the parameter lookback is set to 4 this time:</p>
</section>
<section id="lookback4" class="level2">
<h2 class="anchored" data-anchor-id="lookback4">lookback=4</h2>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="im">import</span> torch</span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="im">import</span> torch.utils.data <span class="im">as</span> data</span>
<span id="cb23-8"><a href="#cb23-8"></a> </span>
<span id="cb23-9"><a href="#cb23-9"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'https://raw.githubusercontent.com/jbrownlee/Datasets/master/airline-passengers.csv'</span>)</span>
<span id="cb23-10"><a href="#cb23-10"></a>timeseries <span class="op">=</span> df[[<span class="st">"Passengers"</span>]].values.astype(<span class="st">'float32'</span>)</span>
<span id="cb23-11"><a href="#cb23-11"></a> </span>
<span id="cb23-12"><a href="#cb23-12"></a><span class="co"># train-test split for time series</span></span>
<span id="cb23-13"><a href="#cb23-13"></a>train_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(timeseries) <span class="op">*</span> <span class="fl">0.67</span>)</span>
<span id="cb23-14"><a href="#cb23-14"></a>test_size <span class="op">=</span> <span class="bu">len</span>(timeseries) <span class="op">-</span> train_size</span>
<span id="cb23-15"><a href="#cb23-15"></a>train, test <span class="op">=</span> timeseries[:train_size], timeseries[train_size:]</span>
<span id="cb23-16"><a href="#cb23-16"></a> </span>
<span id="cb23-17"><a href="#cb23-17"></a><span class="kw">def</span> create_dataset(dataset, lookback):</span>
<span id="cb23-18"><a href="#cb23-18"></a>    <span class="co">"""Transform a time series into a prediction dataset</span></span>
<span id="cb23-19"><a href="#cb23-19"></a><span class="co">    </span></span>
<span id="cb23-20"><a href="#cb23-20"></a><span class="co">    Args:</span></span>
<span id="cb23-21"><a href="#cb23-21"></a><span class="co">        dataset: A numpy array of time series, first dimension is the time steps</span></span>
<span id="cb23-22"><a href="#cb23-22"></a><span class="co">        lookback: Size of window for prediction</span></span>
<span id="cb23-23"><a href="#cb23-23"></a><span class="co">    """</span></span>
<span id="cb23-24"><a href="#cb23-24"></a>    X, y <span class="op">=</span> [], []</span>
<span id="cb23-25"><a href="#cb23-25"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(dataset)<span class="op">-</span>lookback):</span>
<span id="cb23-26"><a href="#cb23-26"></a>        feature <span class="op">=</span> dataset[i:i<span class="op">+</span>lookback]</span>
<span id="cb23-27"><a href="#cb23-27"></a>        target <span class="op">=</span> dataset[i<span class="op">+</span><span class="dv">1</span>:i<span class="op">+</span>lookback<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb23-28"><a href="#cb23-28"></a>        X.append(feature)</span>
<span id="cb23-29"><a href="#cb23-29"></a>        y.append(target)</span>
<span id="cb23-30"><a href="#cb23-30"></a>    <span class="cf">return</span> torch.tensor(X), torch.tensor(y)</span>
<span id="cb23-31"><a href="#cb23-31"></a> </span>
<span id="cb23-32"><a href="#cb23-32"></a><span class="co">## 이번에는 lookback을 4로 놓을 것.    </span></span>
<span id="cb23-33"><a href="#cb23-33"></a>lookback <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb23-34"><a href="#cb23-34"></a>X_train, y_train <span class="op">=</span> create_dataset(train, lookback<span class="op">=</span>lookback)</span>
<span id="cb23-35"><a href="#cb23-35"></a>X_test, y_test <span class="op">=</span> create_dataset(test, lookback<span class="op">=</span>lookback)</span>
<span id="cb23-36"><a href="#cb23-36"></a> </span>
<span id="cb23-37"><a href="#cb23-37"></a><span class="kw">class</span> AirModel(nn.Module):</span>
<span id="cb23-38"><a href="#cb23-38"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb23-39"><a href="#cb23-39"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb23-40"><a href="#cb23-40"></a>        <span class="va">self</span>.lstm <span class="op">=</span> nn.LSTM(input_size<span class="op">=</span><span class="dv">1</span>, hidden_size<span class="op">=</span><span class="dv">50</span>, num_layers<span class="op">=</span><span class="dv">1</span>, batch_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-41"><a href="#cb23-41"></a>        <span class="va">self</span>.linear <span class="op">=</span> nn.Linear(<span class="dv">50</span>, <span class="dv">1</span>)</span>
<span id="cb23-42"><a href="#cb23-42"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb23-43"><a href="#cb23-43"></a>        x, _ <span class="op">=</span> <span class="va">self</span>.lstm(x)</span>
<span id="cb23-44"><a href="#cb23-44"></a>        x <span class="op">=</span> <span class="va">self</span>.linear(x)</span>
<span id="cb23-45"><a href="#cb23-45"></a>        <span class="cf">return</span> x</span>
<span id="cb23-46"><a href="#cb23-46"></a> </span>
<span id="cb23-47"><a href="#cb23-47"></a>model <span class="op">=</span> AirModel()</span>
<span id="cb23-48"><a href="#cb23-48"></a>optimizer <span class="op">=</span> optim.Adam(model.parameters())</span>
<span id="cb23-49"><a href="#cb23-49"></a>loss_fn <span class="op">=</span> nn.MSELoss()</span>
<span id="cb23-50"><a href="#cb23-50"></a>loader <span class="op">=</span> data.DataLoader(data.TensorDataset(X_train, y_train), shuffle<span class="op">=</span><span class="va">True</span>, batch_size<span class="op">=</span><span class="dv">8</span>) <span class="co"># shuffle: 샘플을 섞을지 시간 순서대로 추출할지 결정</span></span>
<span id="cb23-51"><a href="#cb23-51"></a> </span>
<span id="cb23-52"><a href="#cb23-52"></a>n_epochs <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb23-53"><a href="#cb23-53"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(n_epochs):</span>
<span id="cb23-54"><a href="#cb23-54"></a>    model.train()</span>
<span id="cb23-55"><a href="#cb23-55"></a>    <span class="cf">for</span> X_batch, y_batch <span class="kw">in</span> loader:</span>
<span id="cb23-56"><a href="#cb23-56"></a>        y_pred <span class="op">=</span> model(X_batch)</span>
<span id="cb23-57"><a href="#cb23-57"></a>        loss <span class="op">=</span> loss_fn(y_pred, y_batch)</span>
<span id="cb23-58"><a href="#cb23-58"></a>        optimizer.zero_grad()</span>
<span id="cb23-59"><a href="#cb23-59"></a>        loss.backward()</span>
<span id="cb23-60"><a href="#cb23-60"></a>        optimizer.step()</span>
<span id="cb23-61"><a href="#cb23-61"></a>    <span class="co"># Validation</span></span>
<span id="cb23-62"><a href="#cb23-62"></a>    <span class="cf">if</span> epoch <span class="op">%</span> <span class="dv">100</span> <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb23-63"><a href="#cb23-63"></a>        <span class="cf">continue</span></span>
<span id="cb23-64"><a href="#cb23-64"></a>    model.<span class="bu">eval</span>()</span>
<span id="cb23-65"><a href="#cb23-65"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb23-66"><a href="#cb23-66"></a>        y_pred <span class="op">=</span> model(X_train)</span>
<span id="cb23-67"><a href="#cb23-67"></a>        train_rmse <span class="op">=</span> np.sqrt(loss_fn(y_pred, y_train))</span>
<span id="cb23-68"><a href="#cb23-68"></a>        y_pred <span class="op">=</span> model(X_test)</span>
<span id="cb23-69"><a href="#cb23-69"></a>        test_rmse <span class="op">=</span> np.sqrt(loss_fn(y_pred, y_test))</span>
<span id="cb23-70"><a href="#cb23-70"></a>    <span class="bu">print</span>(<span class="st">"Epoch </span><span class="sc">%d</span><span class="st">: train RMSE </span><span class="sc">%.4f</span><span class="st">, test RMSE </span><span class="sc">%.4f</span><span class="st">"</span> <span class="op">%</span> (epoch, train_rmse, test_rmse))</span>
<span id="cb23-71"><a href="#cb23-71"></a> </span>
<span id="cb23-72"><a href="#cb23-72"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb23-73"><a href="#cb23-73"></a>    <span class="co"># shift train predictions for plotting</span></span>
<span id="cb23-74"><a href="#cb23-74"></a>    train_plot <span class="op">=</span> np.ones_like(timeseries) <span class="op">*</span> np.nan</span>
<span id="cb23-75"><a href="#cb23-75"></a>    y_pred <span class="op">=</span> model(X_train)</span>
<span id="cb23-76"><a href="#cb23-76"></a>    y_pred <span class="op">=</span> y_pred[:, <span class="op">-</span><span class="dv">1</span>, :]</span>
<span id="cb23-77"><a href="#cb23-77"></a>    train_plot[lookback:train_size] <span class="op">=</span> model(X_train)[:, <span class="op">-</span><span class="dv">1</span>, :]</span>
<span id="cb23-78"><a href="#cb23-78"></a>    <span class="co"># shift test predictions for plotting</span></span>
<span id="cb23-79"><a href="#cb23-79"></a>    test_plot <span class="op">=</span> np.ones_like(timeseries) <span class="op">*</span> np.nan</span>
<span id="cb23-80"><a href="#cb23-80"></a>    test_plot[train_size<span class="op">+</span>lookback:<span class="bu">len</span>(timeseries)] <span class="op">=</span> model(X_test)[:, <span class="op">-</span><span class="dv">1</span>, :]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 0: train RMSE 225.5574, test RMSE 424.7804
Epoch 100: train RMSE 177.5963, test RMSE 374.4650
Epoch 200: train RMSE 138.9036, test RMSE 332.0411
Epoch 300: train RMSE 108.2241, test RMSE 295.1660
Epoch 400: train RMSE 86.0366, test RMSE 263.5869
Epoch 500: train RMSE 65.9311, test RMSE 232.4372
Epoch 600: train RMSE 51.7861, test RMSE 204.3946
Epoch 700: train RMSE 41.5776, test RMSE 180.0017
Epoch 800: train RMSE 34.7810, test RMSE 159.1152
Epoch 900: train RMSE 29.9309, test RMSE 141.1872
Epoch 1000: train RMSE 26.6003, test RMSE 126.3749
Epoch 1100: train RMSE 24.6251, test RMSE 114.9184
Epoch 1200: train RMSE 23.2474, test RMSE 105.3578
Epoch 1300: train RMSE 22.2368, test RMSE 98.2287
Epoch 1400: train RMSE 21.5524, test RMSE 92.6251
Epoch 1500: train RMSE 21.1995, test RMSE 87.6587
Epoch 1600: train RMSE 20.5447, test RMSE 84.6245
Epoch 1700: train RMSE 20.1870, test RMSE 81.5615
Epoch 1800: train RMSE 20.0715, test RMSE 79.2392
Epoch 1900: train RMSE 19.9252, test RMSE 78.4828</code></pre>
</div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># plot</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>plt.plot(timeseries, label<span class="op">=</span><span class="st">'실제관측치'</span>)</span>
<span id="cb25-3"><a href="#cb25-3"></a>plt.plot(train_plot, c<span class="op">=</span><span class="st">'r'</span>, label<span class="op">=</span><span class="st">'train'</span>)</span>
<span id="cb25-4"><a href="#cb25-4"></a>plt.plot(test_plot, c<span class="op">=</span><span class="st">'g'</span>, label<span class="op">=</span><span class="st">'test'</span>)</span>
<span id="cb25-5"><a href="#cb25-5"></a>plt.legend()</span>
<span id="cb25-6"><a href="#cb25-6"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-04-09-lstm-prac_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<ul>
<li>이전보다(lookback=1) 테스트 데이터에 대해 훨씬 잘 맞춘다.</li>
</ul>
<p>Running the above code will produce the plot below. From both the RMSE measure printed and the plot, you can notice that the model can now do better on the test set.</p>
<p>This is also why the <code>create_dataset()</code> function is designed in such way: When the model is given a time series of time <span class="math inline">\(t\)</span> to <span class="math inline">\(t+3\)</span>(as lookback=4), its output is the prediction of <span class="math inline">\(t+1\)</span> to <span class="math inline">\(t+4\)</span>. However, <span class="math inline">\(t+1\)</span> to <span class="math inline">\(t+3\)</span> are also known from the input. By using these in the loss function, the model effectively was provided with more clues to train. This design is not always suitable but you can see it is helpful in this particular example</p>
</section>
<section id="lookback" class="level2">
<h2 class="anchored" data-anchor-id="lookback">lookback?</h2>
<p><code>-</code> lookback 살펴보기</p>
<ul>
<li>lookback: 입력으로 사용하기 위해 거슬러 올라갈 타임스텝</li>
<li>delay : 타깃으로 사용할 미래의 타임스텝</li>
<li>shuffle: 샘플을 섞을지 시간 순서대로 추출할지 결정</li>
</ul>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a>lookback <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>X_train, y_train <span class="op">=</span> create_dataset(train, lookback<span class="op">=</span>lookback)</span>
<span id="cb26-3"><a href="#cb26-3"></a>X_test, y_test <span class="op">=</span> create_dataset(test, lookback<span class="op">=</span>lookback)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a>X_train.shape, y_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>(torch.Size([92, 4, 1]), torch.Size([92, 4, 1]))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a>df[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Month</th>
      <th>Passengers</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1949-01</td>
      <td>112</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1949-02</td>
      <td>118</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1949-03</td>
      <td>132</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1949-04</td>
      <td>129</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1949-05</td>
      <td>121</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1949-06</td>
      <td>135</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1949-07</td>
      <td>148</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1949-08</td>
      <td>148</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1949-09</td>
      <td>136</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1949-10</td>
      <td>119</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a>X_train.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="106">
<pre><code>tensor([[[112., 118., 132., 129., 121., 135., 148., 148., 136., 119., 104.,
          118., 115., 126., 141., 135., 125., 149., 170., 170., 158., 133.,
          114., 140., 145., 150., 178., 163., 172., 178., 199., 199., 184.,
          162., 146., 166., 171., 180., 193., 181., 183., 218., 230., 242.,
          209., 191., 172., 194., 196., 196., 236., 235., 229., 243., 264.,
          272., 237., 211., 180., 201., 204., 188., 235., 227., 234., 264.,
          302., 293., 259., 229., 203., 229., 242., 233., 267., 269., 270.,
          315., 364., 347., 312., 274., 237., 278., 284., 277., 317., 313.,
          318., 374., 413., 405.],
         [118., 132., 129., 121., 135., 148., 148., 136., 119., 104., 118.,
          115., 126., 141., 135., 125., 149., 170., 170., 158., 133., 114.,
          140., 145., 150., 178., 163., 172., 178., 199., 199., 184., 162.,
          146., 166., 171., 180., 193., 181., 183., 218., 230., 242., 209.,
          191., 172., 194., 196., 196., 236., 235., 229., 243., 264., 272.,
          237., 211., 180., 201., 204., 188., 235., 227., 234., 264., 302.,
          293., 259., 229., 203., 229., 242., 233., 267., 269., 270., 315.,
          364., 347., 312., 274., 237., 278., 284., 277., 317., 313., 318.,
          374., 413., 405., 355.],
         [132., 129., 121., 135., 148., 148., 136., 119., 104., 118., 115.,
          126., 141., 135., 125., 149., 170., 170., 158., 133., 114., 140.,
          145., 150., 178., 163., 172., 178., 199., 199., 184., 162., 146.,
          166., 171., 180., 193., 181., 183., 218., 230., 242., 209., 191.,
          172., 194., 196., 196., 236., 235., 229., 243., 264., 272., 237.,
          211., 180., 201., 204., 188., 235., 227., 234., 264., 302., 293.,
          259., 229., 203., 229., 242., 233., 267., 269., 270., 315., 364.,
          347., 312., 274., 237., 278., 284., 277., 317., 313., 318., 374.,
          413., 405., 355., 306.],
         [129., 121., 135., 148., 148., 136., 119., 104., 118., 115., 126.,
          141., 135., 125., 149., 170., 170., 158., 133., 114., 140., 145.,
          150., 178., 163., 172., 178., 199., 199., 184., 162., 146., 166.,
          171., 180., 193., 181., 183., 218., 230., 242., 209., 191., 172.,
          194., 196., 196., 236., 235., 229., 243., 264., 272., 237., 211.,
          180., 201., 204., 188., 235., 227., 234., 264., 302., 293., 259.,
          229., 203., 229., 242., 233., 267., 269., 270., 315., 364., 347.,
          312., 274., 237., 278., 284., 277., 317., 313., 318., 374., 413.,
          405., 355., 306., 271.]]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a>y_train.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>tensor([[[118., 132., 129., 121., 135., 148., 148., 136., 119., 104., 118.,
          115., 126., 141., 135., 125., 149., 170., 170., 158., 133., 114.,
          140., 145., 150., 178., 163., 172., 178., 199., 199., 184., 162.,
          146., 166., 171., 180., 193., 181., 183., 218., 230., 242., 209.,
          191., 172., 194., 196., 196., 236., 235., 229., 243., 264., 272.,
          237., 211., 180., 201., 204., 188., 235., 227., 234., 264., 302.,
          293., 259., 229., 203., 229., 242., 233., 267., 269., 270., 315.,
          364., 347., 312., 274., 237., 278., 284., 277., 317., 313., 318.,
          374., 413., 405., 355.],
         [132., 129., 121., 135., 148., 148., 136., 119., 104., 118., 115.,
          126., 141., 135., 125., 149., 170., 170., 158., 133., 114., 140.,
          145., 150., 178., 163., 172., 178., 199., 199., 184., 162., 146.,
          166., 171., 180., 193., 181., 183., 218., 230., 242., 209., 191.,
          172., 194., 196., 196., 236., 235., 229., 243., 264., 272., 237.,
          211., 180., 201., 204., 188., 235., 227., 234., 264., 302., 293.,
          259., 229., 203., 229., 242., 233., 267., 269., 270., 315., 364.,
          347., 312., 274., 237., 278., 284., 277., 317., 313., 318., 374.,
          413., 405., 355., 306.],
         [129., 121., 135., 148., 148., 136., 119., 104., 118., 115., 126.,
          141., 135., 125., 149., 170., 170., 158., 133., 114., 140., 145.,
          150., 178., 163., 172., 178., 199., 199., 184., 162., 146., 166.,
          171., 180., 193., 181., 183., 218., 230., 242., 209., 191., 172.,
          194., 196., 196., 236., 235., 229., 243., 264., 272., 237., 211.,
          180., 201., 204., 188., 235., 227., 234., 264., 302., 293., 259.,
          229., 203., 229., 242., 233., 267., 269., 270., 315., 364., 347.,
          312., 274., 237., 278., 284., 277., 317., 313., 318., 374., 413.,
          405., 355., 306., 271.],
         [121., 135., 148., 148., 136., 119., 104., 118., 115., 126., 141.,
          135., 125., 149., 170., 170., 158., 133., 114., 140., 145., 150.,
          178., 163., 172., 178., 199., 199., 184., 162., 146., 166., 171.,
          180., 193., 181., 183., 218., 230., 242., 209., 191., 172., 194.,
          196., 196., 236., 235., 229., 243., 264., 272., 237., 211., 180.,
          201., 204., 188., 235., 227., 234., 264., 302., 293., 259., 229.,
          203., 229., 242., 233., 267., 269., 270., 315., 364., 347., 312.,
          274., 237., 278., 284., 277., 317., 313., 318., 374., 413., 405.,
          355., 306., 271., 306.]]])</code></pre>
</div>
</div>
<ul>
<li><a href="https://miruetoto.github.io/yechan3/posts/3_Researches/ITSTGCN/2022-12-29-STGCN-tutorial.html#pytorch-geometric-temporal-%EC%9D%98-%EC%9E%90%EB%A3%8C%ED%98%95" class="uri">https://miruetoto.github.io/yechan3/posts/3_Researches/ITSTGCN/2022-12-29-STGCN-tutorial.html#pytorch-geometric-temporal-%EC%9D%98-%EC%9E%90%EB%A3%8C%ED%98%95</a></li>
</ul>
<p>lag=4라고 생각하면 될 것같은데 각각 한달 후의 데이터를 예측하는 것이라 <span class="math inline">\(y\)</span>의 차원이 전에 했던거랑 다름.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>